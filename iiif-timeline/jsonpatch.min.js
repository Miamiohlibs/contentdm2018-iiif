(function(){var E=[].indexOf||function(t){for(var e=0,n=this.length;e<n;e++)if(e in this&&this[e]===t)return e;return-1},S=function(t,e){for(var n in e)o.call(e,n)&&(t[n]=e[n]);function r(){this.constructor=t}return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t},o={}.hasOwnProperty;!function(e){var n;n="undefined"!=typeof window&&null!==window?window:"undefined"!=typeof global&&null!==global?global:this,"undefined"!=typeof exports?e(exports):"function"==typeof define&&define.amd?define(["exports"],function(t){return n.jsonpatch=e(t)}):n.jsonpatch=e({})}(function(t){var e,n,a,c,r,o,s,i,u,f,h,p,l,w,d,y,g,v,m,b,_,x,P,j,I,O;return O=Object.prototype.toString,b=Object.prototype.hasOwnProperty,_=function(t){return"[object Array]"===O.call(t)},P=function(t){return"[object Object]"===O.call(t)},j=function(t){return"[object String]"===O.call(t)},w=function(t,e,n){var r,o,i,a,c;if(t===e)return 0!==t||1/t==1/e;if(null===t||null===e)return t===e;if((r=O.call(t))!==O.call(e))return!1;switch(r){case"[object String]":String(t),String(e);break;case"[object Number]":t=+t,e=+e}if("object"!=typeof t||"object"!=typeof e)return!1;for(i=n.length;i--;)if(n[i]===t)return!0;if(n.push(t),a=!(c=0),"[object Array]"===r){if(a=(c=t.length)===e.length)for(;c--&&(a=0<=E.call(t,c)==0<=E.call(e,c)&&w(t[c],e[c],n)););}else{if(0<=E.call(t,"constructor")!=0<=E.call(e,"constructor")||t.constructor!==e.constructor)return!1;for(o in t)if(b.call(t,o)&&(c++,!(a=b.call(e,o)&&w(t[o],e[o],n))))break;if(a){for(o in e)if(b.call(e,o)&&!c--)break;a=!c}}return n.pop(),a},x=function(t,e){return w(t,e,[])},o=function(t){function e(t){this.message=null!=t?t:"JSON patch error",this.name="JSONPatchError"}return S(e,t),e}(Error),c=function(t){function e(t){this.message=null!=t?t:"Invalid pointer",this.name="InvalidPointer"}return S(e,t),e}(Error),a=function(t){function e(t){this.message=null!=t?t:"Invalid patch",this.name="InvalidPatch"}return S(e,o),e}(),u=function(t){function e(t){this.message=null!=t?t:"Patch conflict",this.name="PatchConflictError"}return S(e,o),e}(),f=function(t){function e(t){this.message=null!=t?t:"Patch test failed",this.name="PatchTestFailed"}return S(e,t),e}(Error),v=/~1/g,m=/~0/g,d=/^[-+]?\d+$/,s=function(){function t(t){var e,n,r,o,i;if(i=[],t&&""!==(i=t.split("/")).shift())throw new c;for(e=n=0,r=i.length;n<r;e=++n)o=i[e],i[e]=o.replace(v,"/").replace(m,"~");this.accessor=i.pop(),this.steps=i,this.path=t}return t.prototype.getReference=function(t){var e,n,r,o;for(e=0,n=(r=this.steps).length;e<n;e++){if(o=r[e],_(t)&&(o=parseInt(o,10)),!(o in t))throw new u("Array location out of bounds or not an instance property");t=t[o]}return t},t.prototype.coerce=function(t,e){if(_(t)&&j(e))if("-"===e)e=t.length;else{if(!d.test(e))throw new c("Invalid array index number");e=parseInt(e,10)}return e},t}(),r=function(){function t(t){if(!("path"in t))throw new a;this.validate(t),this.patch=t,this.path=new s(t.path),this.initialize(t)}return t.prototype.initialize=function(){},t.prototype.validate=function(t){},t.prototype.apply=function(t){throw new Error("Method not implemented")},t}(),e=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return S(e,r),e.prototype.validate=function(t){if(!("value"in t))throw new a},e.prototype.apply=function(t){var e,n,r;if(n=this.path.getReference(t),e=this.path.accessor,r=this.patch.value,_(n)){if((e=this.path.coerce(n,e))<0||e>n.length)throw new u("Index "+e+" out of bounds");n.splice(e,0,r)}else null==e?t=r:n[e]=r;return t},e}(),h=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return S(e,r),e.prototype.apply=function(t){var e,n;if(n=this.path.getReference(t),e=this.path.accessor,_(n)){if((e=this.path.coerce(n,e))>=n.length)throw new u("Value at "+e+" does not exist");n.splice(e,1)}else{if(!(e in n))throw new u("Value at "+e+" does not exist");delete n[e]}return t},e}(),p=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return S(e,r),e.prototype.validate=function(t){if(!("value"in t))throw new a},e.prototype.apply=function(t){var e,n,r;if(n=this.path.getReference(t),e=this.path.accessor,r=this.patch.value,null==e)return r;if(_(n)){if((e=this.path.coerce(n,e))>=n.length)throw new u("Value at "+e+" does not exist");n.splice(e,1,r)}else{if(!(e in n))throw new u("Value at "+e+" does not exist");n[e]=r}return t},e}(),l=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return S(e,r),e.prototype.validate=function(t){if(!("value"in t))throw new a("'value' member is required")},e.prototype.apply=function(t){var e,n,r;if(n=this.path.getReference(t),e=this.path.accessor,r=this.patch.value,_(n)&&(e=this.path.coerce(n,e)),!x(n[e],r))throw new f;return t},e}(),i=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return S(e,r),e.prototype.initialize=function(t){var e,n,r,o,i;for(this.from=new s(t.from),i=!0,e=n=0,o=r=this.from.steps.length;0<=o?n<=o:o<=n;e=0<=o?++n:--n)if(this.from.steps[e]!==this.path.steps[e]){i=!1;break}if(i){if(this.path.steps.length!==r)throw new a("'to' member cannot be a descendent of 'path'");if(this.from.accessor===this.path.accessor)return this.apply=function(t){return t}}},e.prototype.validate=function(t){if(!("from"in t))throw new a("'from' member is required")},e.prototype.apply=function(t){var e,n,r;if(n=this.from.getReference(t),e=this.from.accessor,_(n)){if((e=this.from.coerce(n,e))>=n.length)throw new u("Value at "+e+" does not exist");r=n.splice(e,1)[0]}else{if(!(e in n))throw new u("Value at "+e+" does not exist");r=n[e],delete n[e]}if(n=this.path.getReference(t),e=this.path.accessor,_(n)){if((e=this.path.coerce(n,e))<0||e>n.length)throw new u("Index "+e+" out of bounds");n.splice(e,0,r)}else{if(e in n)throw new u("Value at "+e+" exists");n[e]=r}return t},e}(),n=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return S(e,i),e.prototype.apply=function(t){var e,n,r;if(n=this.from.getReference(t),e=this.from.accessor,_(n)){if((e=this.from.coerce(n,e))>=n.length)throw new u("Value at "+e+" does not exist");r=n.slice(e,e+1)[0]}else{if(!(e in n))throw new u("Value at "+e+" does not exist");r=n[e]}if(n=this.path.getReference(t),e=this.path.accessor,_(n)){if((e=this.path.coerce(n,e))<0||e>n.length)throw new u("Index "+e+" out of bounds");n.splice(e,0,r)}else{if(e in n)throw new u("Value at "+e+" exists");n[e]=r}return t},e}(),I={add:e,remove:h,replace:p,move:i,copy:n,test:l},g=function(t){var e,n,r,o,i;if(!_(t)){if(!P(t))throw new a("patch must be an object or array");t=[t]}for(o=[],e=0,r=t.length;e<r;e++){if(i=t[e],!(n=I[i.op]))throw new a("invalid operation: "+i.op);o.push(new n(i))}return function(t){var e,n,r;for(r=t,e=0,n=o.length;e<n;e++)r=o[e].apply(r);return r}},y=function(t,e){return g(e)(t)},t.version="0.7.0",t.apply=y,t.compile=g,t.JSONPointer=s,t.JSONPatch=r,t.JSONPatchError=o,t.InvalidPointerError=c,t.InvalidPatchError=a,t.PatchConflictError=u,t.PatchTestFailed=f,t})}).call(this);